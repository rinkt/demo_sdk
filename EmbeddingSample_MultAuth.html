<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GuestLoginExample test1</title>
    <script type="text/javascript" src="https://env-268550.customer.cloud.microstrategy.com/MicroStrategyLibrary/javascript/embeddinglib.js"></script>
</head>
<body onload="showDossier()">

<div id="myDossier"></div>

<script type="text/javascript">


    var BASE_URL = "https://env-268550.customer.cloud.microstrategy.com/MicroStrategyLibrary";
    var projectId = "B7CA92F04B9FAE8D941C3E9B7E0CD754";
    var dossierId = "1985AA1EA841787FB15E60915D98C249";


    function login() {
        var options = {
            method: 'POST',
            credentials: 'include', // Including cookie
            mode: 'cors',  // Setting as cors mode for cross origin
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                loginMode: 8  // Login as guest user.
            })
        };
        return fetch(BASE_URL + '/api/auth/login', options)
            .then(function (response) {
                if (response.ok) {
                    return response.headers.get('x-mstr-authToken');
                } else {
                    response.json().then(function(json) {
                        console.log(json);
                    });
                }
            }).catch(function (error) {
                console.log(error);
            });
    }

    function showDossier() {
        var placeHolderDiv = document.getElementById("myDossier");
        var dossierUrl = BASE_URL +'/app/'+ projectId + '/' + dossierId;
        microstrategy.dossier.create({
            placeholder: placeHolderDiv,
            url: dossierUrl,
            enableCustomAuthentication: true,
            enableResponsive: true,
            customAuthenticationType: microstrategy.dossier.CustomAuthenticationType.AUTH_TOKEN,
            getLoginToken: login
        });
    }

</script>

</body>
</html>